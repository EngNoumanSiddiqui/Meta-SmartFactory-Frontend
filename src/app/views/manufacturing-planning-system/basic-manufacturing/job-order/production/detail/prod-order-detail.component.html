 <div class="animated fadeIn">
    <div class="row text-center noData" *ngIf="!isLoading() && (!jobDetail)">
      <strong class=""><i class="fa fa-warning "></i>{{'NO_PROD_DETAIL_FOUND'|translate}}!</strong>
    </div>

   <button *ngIf="jobDetail" type="button" style="margin-right: 5px" class="btn rounded btn-warning float-right"
           (click)="getPrintHtmlDocument()"><i class="fa fa-file"></i> {{'print-production-order' | translate}}</button>
   <print-component [active]="printComponent.active" [editMode]="true" [requestPrintDto]="requestPrintDto"
                    (activeEvent)="printComponent.active=$event"></print-component>


    <p-tabView *ngIf="jobDetail">
      <p-tabPanel header="{{'prod-order-detail'|translate}}">
        <div class="card">
          <div class="card-header">{{'prod-order-detail'|translate}}</div>
          <div class="card-body">
            <div class="row justify-content-end">
              <button pButton type="button" style="margin-right: 15px;"
              icon="fa fa-refresh" name="refresh" (click)="initialize(jobDetail.prodOrderId)"></button>
            </div>
            <div class="row">
              <div class="col-md-6">
                <table class="table table-sm   table-outline bg-white">
                  <!-- <thead class="table-secondary">
                  <tr>
                    <th colspan="2"> {{'prod-order-detail'|translate}}</th>
                  </tr>
                  </thead> -->
                  <tbody>
                  <tr>
                    <td width="30%">{{'prod-order-id' | translate}}<span class="float-right">:</span></td>
                    <td> {{jobDetail.prodOrderId}}</td>
                  </tr>
                  <tr>
                    <td width="30%">{{'material-no' | translate}}<span class="float-right">:</span></td>
                    <td>
                      <a href="javascript:;" (click)="showMaterialDetail(jobDetail.materialId)">
                        {{jobDetail.materialNo}}</a>
                    </td>
                  </tr>
                  <tr>
                    <td width="30%">{{'product' | translate}}<span class="float-right">:</span></td>
                    <td>
                      <a href="javascript:;" (click)="showMaterialDetail(jobDetail.materialId)">{{jobDetail.materialName}}</a>
                    </td>
                  </tr>
                  <tr>
                    <td width="30%">{{'plant' | translate}}<span class="float-right">:</span></td>
                    <td>
                      <a href="javascript:;" (click)="showPlantDetail(jobDetail.plantId)">{{jobDetail.plantName}}</a>
                     </td>
                  </tr>
                  <tr>
                    <td width="30%">{{'production-order-type' | translate}}<span class="float-right">:</span></td>
                    <td>{{jobDetail?.prodOrderType}}</td>
                  </tr>
                  <tr>
                    <td width="30%">{{'batch' | translate}}<span class="float-right">:</span></td>
                    <td>
                      <a href="javascript:;" (click)="showBatchDetail(jobDetail?.batch)"> {{jobDetail?.batch}}</a>
                    </td>
                  </tr>
                  <tr>
                    <td width="30%">{{'order-quantity' | translate}}<span class="float-right">:</span></td>
                    <td> {{jobDetail.quantity}}</td>
                  </tr>
                  <tr>
                      <td width="30%">{{'produced-quantity' | translate}}<span class="float-right">:</span></td>
                      <td> {{jobDetail.deliveryQuantity}}</td>
                    </tr>
                    <tr>
                      <td width="30%">{{'extra-produced-quantity-percentage' | translate}}<span class="float-right">:</span></td>
                      <td> {{jobDetail.extraProducedQuantityPercentage}}</td>
                    </tr>

                    <tr>
                      <td width="30%">{{'minimum-delay-quantity' | translate}}<span class="float-right">:</span></td>
                      <td> {{jobDetail.minimumDelayQuantityBetweenOperation}}</td>
                    </tr>

                  <!-- <tr>
                    <td width="30%">{{'gr-quantity' | translate}}<span class="float-right">:</span></td>
                    <td> {{jobDetail.grQuantity}}</td>
                  </tr>

                  <tr>
                    <td width="30%">{{'order-unit' | translate}}<span class="float-right">:</span></td>
                    <td> {{jobDetail.orderUnit}}</td>
                  </tr> -->
                  <tr>
                    <td width="30%">{{'base-unit' | translate}}<span class="float-right">:</span></td>
                    <td> {{jobDetail.baseUnit}}</td>
                  </tr>
                  <tr>
                    <td width="30%">{{'store-location' | translate}}<span class="float-right">:</span></td>
                    <td>
                      <a href="javascript:;" (click)="showWarehouseDetail(jobDetail?.warehouse?.wareHouseId)">{{jobDetail.warehouseName}}</a>
                    </td>
                  </tr>
                  <tr>
                    <td>{{'location-no' |translate}}<span class="float-right">:</span></td>
                    <td>{{jobDetail.locationNo}}</td>
                  </tr>
                  <tr>
                    <td>{{'barcode' |translate}}<span class="float-right">:</span></td>
                    <td>{{jobDetail.barcode}}</td>
                  </tr>

                  <tr>
                    <td width="30%">{{'product-tree-id' | translate}}<span class="float-right">:</span></td>
                    <td>
                      <a href="javascript:;" (click)="showProducTreeDetail(jobDetail?.productTreeId)">{{jobDetail.productTreeId}}</a>
                    </td>
                  </tr>

                  <tr *ngIf="jobDetail.scrapId && jobDetail.scrapId !== 0">
                    <td width="30%">{{'scrap-id' | translate}}<span class="float-right">:</span></td>
                    <td>
                      <a href="javascript:;" (click)="showScrapDetail(jobDetail?.scrapId)">{{jobDetail.scrapId}}</a>
                    </td>
                  </tr>

                </table>
              </div>
              <div class="col-md-6">
                <table class="table table-sm   table-outline bg-white">
                  <tbody>
                    <tr>
                      <td width="30%">{{'create-date' | translate}}<span class="float-right">:</span></td>
                      <td> {{jobDetail.createDate|date:"dd/MM/yyyy HH:mm:ss"}}</td>
                    </tr>
                    <tr>
                      <td width="30%">{{'start-date' | translate}}<span class="float-right">:</span></td>
                      <td> {{jobDetail.startDate|date:"dd/MM/yyyy HH:mm:ss"}}</td>
                    </tr>
                    <tr>
                      <td width="30%">{{'end-date' | translate}}<span class="float-right">:</span></td>
                      <td> {{jobDetail.finishDate|date:"dd/MM/yyyy HH:mm:ss"}}</td>
                    </tr>

                    <tr>
                      <td width="30%">{{'due-date' | translate}}<span class="float-right">:</span></td>
                      <td> {{jobDetail.erpPlannedFinishDate|date:"dd/MM/yyyy HH:mm:ss"}}</td>
                    </tr>

                    <tr>
                      <td width="30%">{{'scheduled-start-date' | translate}}<span class="float-right">:</span></td>
                      <td> {{jobDetail.scheduledStartTime|date:"dd/MM/yyyy HH:mm:ss"}}</td>
                    </tr>
                    <tr>
                      <td width="30%">{{'scheduled-finish-date' | translate}}<span class="float-right">:</span></td>
                      <td> {{jobDetail.scheduledFinishTime|date:"dd/MM/yyyy HH:mm:ss"}}</td>
                    </tr>

                    <tr>
                      <td width="30%">{{'actual-start' | translate}}<span class="float-right">:</span></td>
                      <td> {{jobDetail.actualStart|date:"dd/MM/yyyy HH:mm:ss"}}</td>
                    </tr>
                    <tr>
                      <td width="30%">{{'actual-finish' | translate}}<span class="float-right">:</span></td>
                      <td> {{jobDetail.actualFinish|date:"dd/MM/yyyy HH:mm:ss"}}</td>
                    </tr>
                    <tr>
                      <td width="30%">{{'status' | translate}}<span class="float-right">:</span></td>
                      <td> {{ jobDetail.prodOrderStatus }}</td>
                    </tr>
                    <tr>
                      <td width="30%">{{'priority' | translate}}<span class="float-right">:</span></td>
                      <td> {{ jobDetail.priority }}</td>
                    </tr>
                    <tr>
                      <td width="30%">{{'reference-id' | translate}}<span class="float-right">:</span></td>
                      <td> {{ jobDetail?.referenceId }}</td>
                    </tr>
                    <tr>
                      <td width="30%">{{'project' | translate}}<span class="float-right">:</span></td>
                      <td>
                        <a href="javascript:;" (click)="showProjectDetail(jobDetail?.milestone?.project?.projectId)">
                        {{jobDetail?.milestone?.project?.code}} {{jobDetail?.milestone?.project?.name}}</a>
                      </td>
                    </tr>
                    <tr>
                      <td width="30%">{{'milestone' | translate}}<span class="float-right">:</span></td>
                      <td>
                        <a href="javascript:;" (click)="showMilestoneDetail(jobDetail?.milestone?.milestoneId)">
                          {{jobDetail?.milestone?.code}} {{jobDetail?.milestone?.name}} </a>
                      </td>
                    </tr>
                    <tr>
                      <td width="30%">{{'milestone-refid' | translate}}<span class="float-right">:</span></td>
                      <td>

                          {{jobDetail?.mileStoneRefId}}
                      </td>
                    </tr>
                    <tr>
                      <td width="30%">{{'description' | translate}}<span class="float-right">:</span></td>
                      <td>
                        <textarea style="background-color: #ffffff;" class="form-control"
                        [(ngModel)]="jobDetail.description" disabled></textarea>
                        <!-- {{jobDetail?.description}} -->
                      </td>
                    </tr>
                  </tbody>
                </table>

              </div>
            </div>
          </div>
        </div>

      </p-tabPanel>
      <p-tabPanel *ngIf="jobDetail.orderDetail"  header=" {{'sales-order-detail'|translate}}" >
          <div class="row">
              <div class="col-md-12" *ngIf="jobDetail.orderDetail as saleOrder">
                <table class="table table-sm   table-outline bg-white">
                  <thead class="table-secondary">
                  <tr>
                    <th colspan="2">{{'sales-order-detail'|translate}}</th>
                  </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td width="30%">{{'sales-order-detail-id' | translate}}<span class="float-right">:</span></td>
                      <td>
                        <a href="javascript:;" (click)="showSalesorderItemDetail(saleOrder.orderId)" > {{saleOrder.orderId}}</a>
                      </td>

                    </tr>
                    <tr>
                      <td width="30%">{{'sales-order-id' | translate}}<span class="float-right">:</span></td>
                      <td>
                        <a href="javascript:;" (click)="showSalesorderDetail(saleOrder.order?.orderId)" > {{saleOrder.order?.orderId}}</a>
                      </td>
                    </tr>
                  <tr>
                    <td width="30%">{{'sales-order-no' | translate}}<span class="float-right">:</span></td>
                    <td>{{saleOrder.order?.orderNo}}</td>
                  </tr>
                  <tr>
                    <td width="30%">{{'document-no' | translate}}<span class="float-right">:</span></td>
                    <td>{{saleOrder.documentNo}}</td>
                  </tr>
                  <tr>
                    <td width="30%">{{'customer-name' | translate}}<span class="float-right">:</span></td>
                    <td>
                      <a href="javascript:;" (click)="showCustomerDetail(saleOrder.order?.actId)" > {{saleOrder.order?.actName}}</a>
                    </td>
                  </tr>
                  <tr>
                    <td width="30%">{{'planned-quantity' | translate}}<span class="float-right">:</span></td>
                    <td>{{saleOrder.plannedQuantity}}</td>
                  </tr>
                  <tr>
                    <td width="30%">{{'completed-quantity' | translate}}<span class="float-right">:</span></td>
                    <td>{{saleOrder.completedQuantity}}</td>
                  </tr>
                  <tr>
                    <td width="30%">{{'delivery-quantity' | translate}}<span class="float-right">:</span></td>
                    <td>{{saleOrder.deliveredQuantity}}</td>
                  </tr>
                  <tr>
                    <td width="30%">{{'order-unit' | translate}}<span class="float-right">:</span></td>
                    <td>{{saleOrder.unit}}</td>
                  </tr>

                  <tr>
                    <td width="30%">{{'detail-status' | translate}}<span class="float-right">:</span></td>
                    <td>{{saleOrder.orderDetailStatus}}</td>
                  </tr>
                  <!-- <tr>
                    <td width="30%">{{'group-code' | translate}}<span class="float-right">:</span></td>
                    <td>{{saleOrder.groupCodeId}}</td>
                  </tr> -->
                  <tr>
                    <td width="30%">{{'order-date' | translate}}<span class="float-right">:</span></td>
                    <td>{{saleOrder.order?.orderDate|date:"dd/MM/yyyy HH:mm:ss"}}</td>
                  </tr>
                  <tr>
                    <td width="30%">{{'delivery-date' | translate}}<span class="float-right">:</span></td>
                    <td>{{saleOrder.deliveryDate|date:"dd/MM/yyyy HH:mm:ss"}}</td>
                  </tr>
                  <tr>
                    <td width="30%">{{'description' | translate}}<span class="float-right">:</span></td>
                    <td>
                      <textarea style="background-color: #ffffff;" class="form-control"
                      [(ngModel)]="saleOrder.description" disabled></textarea>
                      <!-- {{saleOrder.description}} -->
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
      </p-tabPanel>
      <p-tabPanel header="{{'job-order-list'|translate}}">
        <div class="row justify-content-end mb-1" >
          <div class="mr-2" style="align-items: center;display: flex;">
          <button *ngIf="jobDetail" type="button" style="margin-right: 5px; background-color: #ff9900; font-weight: bold;" class="btn rounded btn-warning float-right"
            (click)="getJobPrintHtmlDocument()"><i class="fa fa-file"></i> {{'print-job-orders' | translate}}</button>

          </div>


          <div class="mr-2" style="align-items: center;display: flex;">
            <label class="mb-0 mr-1">{{'show-original' |translate}}</label>
            <p-checkbox class="p-0" name="showOriginal"  binary="true"
            [(ngModel)]="showOriginal" (ngModelChange)="onShowOriginalChanged($event)"></p-checkbox>
          </div>
          <div class="mr-2" style="align-items: center;display: flex;">
            <label class="mb-0 mr-1">{{'show-material-no' |translate}}</label>
            <p-checkbox class="p-0" name="showMaterialNo"  binary="true"
            [(ngModel)]="showMaterialNo"></p-checkbox>
          </div>
          <button class="btn btn-info mr-2" type="button"
          [disabled]="!selectedJobOrderList || !(selectedJobOrderList.length > 1) "
          (click)="updatNext()"
          >{{'update-next' | translate}}</button>
          <button class="btn btn-primary mr-2" type="button"
                (click)="onTreeViewClicked()"
                >{{'tree-view' | translate}}</button>
          <button pButton type="button ml-3" style="margin-right: 15px;"
          icon="fa fa-refresh" name="refresh" (click)="initialize(jobDetail.prodOrderId)"></button>
        </div>
          <div class="row">
              <div class="col-md-12">
                <!-- [autoLayout]="true" -->
              <p-table class="ui-modal-table job-order-table" [columns]="cols"
              [autoLayout]="true" [value]="jobOrderList" [(selection)]="selectedJobOrderList" >
                  <ng-template pTemplate="caption">
                    {{'job-order-list' | translate}}
                  </ng-template>
                  <ng-template pTemplate="header" let-columns>
                      <tr>
                        <th>{{'action'|translate}}</th>
                        <ng-container *ngFor="let col of columns; let i=index">
                          <th style="cursor: pointer" [ngClass]="{'bg-selected-order':pageFilter.orderByProperty ==col.field}"
                            (click)="reOrderData(i,col.field)">
                            <i *ngIf="isOrderable(col.field)" [ngClass]="'fa fa-sort-alpha-' + classReOrder[i]"></i>
                            {{col.header|translate}}
                          </th>
                        </ng-container>


                          <!-- <th *ngFor="let col of columns">
                              {{col.header | translate}}
                          </th> -->
                      </tr>

                      <tr>
                        <th><p-tableHeaderCheckbox></p-tableHeaderCheckbox></th>
                        <th *ngFor="let col of cols" class="ui-fluid" [ngSwitch]="col.field">
                          <select *ngSwitchCase="'jobOrderStatus'" name="status" class="form-control"
                            [(ngModel)]="pageFilter.jobOrderStatus" (ngModelChange)="filter(pageFilter)">
                            <option [ngValue]="null"> {{'please-select' | translate}}</option>
                            <option *ngFor="let status of jobOrderStatusList" value="{{status}}">{{status|translate}}</option>
                          </select>

                          <p-calendar *ngSwitchCase="'plannedStart'" [showIcon]="true" dateFormat="dd.mm.yy"
                             [monthNavigator]="true" [yearNavigator]="true" baseZIndex="99999999"
                            yearRange="1990:2100" appendTo="body" [(ngModel)]="pageFilter.startDate"
                            placeholder="{{'start-date'|translate}}" (ngModelChange)="filter(pageFilter)">
                          </p-calendar>

                          <p-calendar *ngSwitchCase="'plannedFinish'" [showIcon]="true" dateFormat="dd.mm.yy"
                             [monthNavigator]="true" [yearNavigator]="true" baseZIndex="99999999"
                            yearRange="1990:2100" appendTo="body" [(ngModel)]="pageFilter.finishDate"
                            placeholder="{{'finish-date'|translate}}" (ngModelChange)="filter(pageFilter)">
                          </p-calendar>

                          <ng-container *ngSwitchCase="'jobOrderId'">
                            <input  style="width: 100%" pInputText type="text" [(ngModel)]="pageFilter[col.field]"
                            (input)="filterByColumn($event.target.value,col.field)">
                          </ng-container>

                          <ng-container *ngSwitchCase="'jobOrderOperations'">
                            <input  style="width: 100%" pInputText type="text" [(ngModel)]="pageFilter.operationUseName"
                            (input)="filterByColumn($event.target.value,'operationUseName')">
                          </ng-container>

                          <ng-container *ngSwitchCase="'batch'">
                            <input  style="width: 100%" pInputText type="text" [(ngModel)]="pageFilter[col.field]"
                            (input)="filterByColumn($event.target.value,col.field)">
                          </ng-container>

                          <ng-container *ngSwitchCase="'workStation'">
                            <input  style="width: 100%" pInputText type="text" [(ngModel)]="pageFilter.workStationName"
                            (input)="filterByColumn($event.target.value,'workStationName')">
                          </ng-container>


                        </th>

                      </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-list let-columns="columns">
                    <tr [pSelectableRow]="list">
                      <td>
                        <p-tableCheckbox [value]="list"></p-tableCheckbox>
                        <ng-container *ngIf="list.jobOrderStatus==='LONG_TERM_PROCESSING'">
                          <ul *ngFor="let operation of list?.jobOrderOperations; last as oLast"
                              [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <li>
                                <button class="btn btn-sm btn-outline-info" type="button" pTooltip="EDIT IT "
                                tooltipPosition="top" placeholder="Top" [tooltipZIndex]="'9999999'"  (click)="showEditJobOrder(list, operation)">
                                <i class="fa fa-edit"></i></button>
                              </li>
                          </ul>
                        </ng-container>

                        <button type="button" class="btn btn-sm btn-outline-primary"
                        pTooltip="Divide Job Order" tooltipPosition="top" placeholder="Top" [tooltipZIndex]="'9999999'"
                        (click)="openDivideDialog(list)">
                        <i class="fa fa-first-order"></i>
                        </button>

                      </td>
                      <td>{{list.orderFNo}}</td>
                      <td>
                        <a href="javascript:;" (click)="showJobOrderDetail(list.jobOrderId)" > {{list.jobOrderId}}</a>

                      </td>
                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                          [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <li>
                                <a href="javascript:;" (click)="showJobOrderOperationDetail(operation.jobOrderOperationId)">
                                  {{operation.jobOrderOperationId}}</a>
                                <!-- {{operation.jobOrderOperationId}} -->
                              </li>
                          </ul>
                        </ng-container>
                      </td>

                      <td style=" padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                          [style.height]="getOperationDataHeight(operation).height + 'px'"
                          [style.max-height]="getOperationDataHeight(operation).height + 'px'"
                              style="overflow: hidden;
                              text-overflow: ellipsis;">
                              <li>
                                <a href="javascript:;" (click)="showOperationDetail(operation.operationId)"
                                pTooltip="{{operation.operationName}}" tooltipPosition="top" [tooltipZIndex]="'9999999'"
                                >{{operation.operationName}}</a>
                              </li>
                          </ul>
                        </ng-container>
                      </td>

                      <td style=" padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'"
                              [style.max-height]="getOperationDataHeight(operation).height + 'px'"
                              style="overflow: hidden;text-overflow: ellipsis;">
                              <!-- [style.height]="(getOperationDataHeight(operation).height/getOperationDataHeight(operation).totalHeight) + 'px'" -->
                              <li *ngFor="let item of operation.jobOrderStockUseList; last as jLast"
                              >
                                <a href="javascript:;" (click)="showStockDetail(item.stockId)"
                                pTooltip="{{showMaterialNo ? (item.stockName) : (item.stockNo)}}" tooltipPosition="top"
                                [tooltipZIndex]="'9999999'">
                                {{showMaterialNo ? (item.stockNo) : (item.stockName)}}</a>
                              </li>
                          </ul>
                        </ng-container>
                      </td>

                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <!-- [style.height]="(getOperationDataHeight(operation).height/getOperationDataHeight(operation).totalHeight) + 'px'" -->
                              <li *ngFor="let item of operation.jobOrderStockUseList"
                              >
                                <span>{{(item.neededQuantity ? item.neededQuantity : '') | number:'1.2-2'}}</span>
                              </li>
                          </ul>
                        </ng-container>
                      </td>



                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'"
                              [style.max-height]="getOperationDataHeight(operation).height + 'px'"
                              style="overflow: hidden;
                              text-overflow: ellipsis;">
                              <!-- [style.height]="(getOperationDataHeight(operation).height/getOperationDataHeight(operation).totalHeight) + 'px'" -->
                              <li *ngFor="let item of operation.jobOrderStockProduceList"
                              >
                              <a href="javascript:;" (click)="showStockDetail(item.stockId)"
                              pTooltip="{{showMaterialNo ? (item.stockName) : (item.stockNo)}}" tooltipPosition="top"
                              [tooltipZIndex]="'9999999'">
                              {{showMaterialNo ? (item.stockNo) : (item.stockName)}}</a>
                              </li>
                          </ul>
                        </ng-container>
                      </td>

                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <!-- [style.height]="(getOperationDataHeight(operation).height/getOperationDataHeight(operation).totalHeight) + 'px'" -->
                              <li *ngFor="let item of operation.jobOrderStockProduceList"
                              >
                                <span>{{(item.neededQuantity ? item.neededQuantity : '') | number:'1.2-2'}}</span>
                              </li>
                          </ul>
                        </ng-container>
                      </td>

                      <!-- <td>
                        <a href="javascript:;" (click)="showBatchDetail(list.batch)">{{list.batch}}</a>
                      </td> -->

                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'"
                              [style.max-height]="getOperationDataHeight(operation).height + 'px'">
                              <li *ngFor="let item of operation.jobOrderStockProduceList">
                                {{item?.currentStockQuantity}}
                              </li>
                          </ul>
                        </ng-container>
                        <!-- <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <li>
                                <span>
                                  {{(operation.jobOrderStockProduceList && operation.jobOrderStockProduceList.length) ? operation.jobOrderStockProduceList[0].currentStockQuantity: 0 }}
                                </span>
                              </li>
                          </ul>
                        </ng-container> -->
                      </td>

                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'"
                              [style.max-height]="getOperationDataHeight(operation).height + 'px'">
                              <li *ngFor="let item of operation.jobOrderStockProduceList">
                                {{item?.defectQuantity}}
                              </li>
                          </ul>
                        </ng-container>

                      </td>

                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <!-- [style.height]="(getOperationDataHeight(operation).height/getOperationDataHeight(operation).totalHeight) + 'px'" -->
                              <li *ngFor="let item of operation.jobOrderStockUseList"
                              >
                                <span>{{item.waitingForJobDeliveredQuantity}}</span>
                              </li>
                          </ul>
                        </ng-container>
                      </td>
                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <li>
                                <span>
                                  {{getDuration(operation.singleDuration)}}
                                </span>
                                <!-- <span>{{operation.currentQuantity}}</span> -->
                              </li>
                          </ul>
                        </ng-container>
                      </td>
                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <li>
                                <span>
                                  {{getDuration(operation.singleTotalDuration)}}
                                </span>
                                <!-- <span>{{operation.currentQuantity}}</span> -->
                              </li>
                          </ul>
                        </ng-container>
                      </td>
                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <li>
                                <span>
                                  {{getDuration(operation.actualTotalDuration)}}
                                </span>
                                <!-- <span>{{operation.currentQuantity}}</span> -->
                              </li>
                          </ul>
                        </ng-container>
                      </td>
                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <li>
                                <span>
                                  {{operation.variableCost}}
                                </span>
                                <!-- <span>{{operation.currentQuantity}}</span> -->
                              </li>
                          </ul>
                        </ng-container>
                      </td>
                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <li>
                                <span>
                                  {{operation.currency}}
                                </span>
                                <!-- <span>{{operation.currentQuantity}}</span> -->
                              </li>
                          </ul>
                        </ng-container>
                      </td>
                      <td style=" padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <li><span>{{operation.operationStatus}}</span></li>
                          </ul>
                        </ng-container>
                      </td>


                      <td style="padding: 0;">
                        <ng-container *ngFor="let operation of list?.jobOrderOperations; last as oLast">
                          <ul [style.borderBottom]="(oLast) ? 'none': '1px solid #c8c8c8'" class="jOrderParent"
                              [style.height]="getOperationDataHeight(operation).height + 'px'">
                              <li>
                                <a href="javascript:;" (click)="showWorkstationDetail(operation.workStationId)"
                                pTooltip="{{operation.workStationName}}" tooltipPosition="top" [tooltipZIndex]="'9999999'">{{operation.workStationName}}</a>
                              </li>
                          </ul>
                        </ng-container>
                      </td>

                      <td>{{list.startDate|date:"dd/MM/yyyy HH:mm:ss" }}</td>

                      <td>{{list.finishDate|date:"dd/MM/yyyy HH:mm:ss" }}</td>

                      <td>{{list.jobOrderStatus}} </td>
                      <td>
                        <a href="javascript:;" (click)="showJobOrderDetail(list.jobOrderId)">
                          {{list.referenceId}}</a>
                      </td>


                    </tr>
                  </ng-template>
                </p-table>
              </div>
          </div>
      </p-tabPanel>
      <p-tabPanel  header="{{'reservation-list'|translate}}" >
        <div class="row justify-content-end" *ngIf="jobDetail.reservationList">

          <div class="col-3" style="align-items: center;justify-content: end;display: flex;">

            <label class="col-4 p-0 mb-0">{{'show-cancelled' |translate}}</label>
            <p-checkbox class="p-0" name="showCancelled"  binary="true"
            [(ngModel)]="showCancelled" (ngModelChange)="onShowCancelledChanged($event)"></p-checkbox>
          </div>

          <button pButton type="button" style="margin-right: 15px;"
          icon="fa fa-refresh" name="refresh" (click)="initialize(jobDetail.prodOrderId)"></button>
        </div>
        <div class="row" *ngIf="jobDetail.reservationList">
            <div class="col-md-12">
              <p-table class="ui-modal-table" [columns]="reservationSelectedColumns" [value]="reservationList" autoLayout="true">
                <ng-template pTemplate="caption">
                    <div class="row">
                      <p-multiSelect class="col-md-3" [options]="reservationCols" [(ngModel)]="reservationSelectedColumns" optionLabel="header" maxSelectedLabels="0"  selectedItemsLabel="{{'columns-selected'|translate}}"
                                     [style]="{minWidth: '200px'}" defaultLabel="Choose Columns">
                        <ng-template let-col let-i="index" pTemplate="item">
                          {{col.label|translate}}
                        </ng-template>
                      </p-multiSelect>
                      <div class="col-md-5" style="text-align: center;align-self: center;">
                        {{'reservation-list'|translate}}
                      </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="header" let-columns>
                    <tr>
                      <th style="width: 3em" rowspan="2">
                      </th>
                        <th *ngFor="let col of columns">
                            {{col.header | translate}}
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-columns="columns">
                  <tr>
                    <td style="width: 3em">
                      <button class="btn btn-sm btn-outline-primary" type="button"
                      (click)="showEditReservationModal(rowData)">
                        <i class="fa fa-edit"></i></button>
                      <button class="btn btn-sm btn-outline-secondary" type="button"
                      (click)="showReservationModal(rowData)">
                        <i class="fa fa-search"></i></button>
                    </td>
                    <td [class.bg-danger]="col.field === 'requirementQuantity' && rowData['requirementQuantity'] > rowData['deliveredQuantity']" *ngFor="let col of columns" style="cursor: pointer" [ngSwitch]="col.field">

                      <a href="javascript:;" *ngSwitchCase="'waitingForJobOrderOperationId'"
                      (click)="showJobOrderOperationDetail(rowData.waitingForJobOrderOperationId)">{{rowData.waitingForJobOrderOperationId}}</a>
                      <a href="javascript:;" *ngSwitchCase="'reservationId'" (click)="showReservationDetail(rowData.reservationId)" > {{rowData.reservationId}}</a>
                      <a href="javascript:;" *ngSwitchCase="'warehouseName'"
                      (click)="showWarehouseDetail(rowData.warehouseId)" > {{rowData.warehouseName}}</a>
                      <a href="javascript:;" *ngSwitchCase="'warehouseFromName'"
                  (click)="showWarehouseDetail(rowData.fromWareHouse?.wareHouseId)" >
                  {{rowData.fromWareHouse?.wareHouseName}}</a>

                      <a href="javascript:;" *ngSwitchCase="'batch'" (click)="showBatchDetail(rowData.batch)" > {{rowData.batch}}</a>

                      <p-checkbox *ngSwitchCase="'finalIssue'" name="finalIssue" binary="true" disabled="true"
                                  [(ngModel)]="rowData.finalIssue"
                                  pTooltip="{{'final-issue'  | translate}}"
                                  tooltipPosition="top" [tooltipZIndex]="'9999999'">
                      </p-checkbox>

                      <a *ngSwitchCase="'materialName'" href="javascript:;" (click)="showStockDetail(rowData.materialId)">{{rowData[col.field]}}</a>

                      <a *ngSwitchCase="'materialNo'" href="javascript:;" (click)="showStockDetail(rowData.materialId)">{{rowData[col.field]}}</a>

                      <a *ngSwitchCase="'plantName'" href="javascript:;" (click)="showPlantDetail(rowData.plantId)">{{rowData[col.field]}}</a>

                      <a *ngSwitchCase="'purchaseOrderDetailId'" href="javascript:;" (click)="showPurchaseOrderDetailItem(rowData.purchaseOrderDetailId)">{{rowData[col.field]}}</a>

                      <span *ngSwitchCase="'requirementQuantity'" [class.text-white]="rowData['requirementQuantity'] > rowData['deliveredQuantity']">{{rowData[col.field] | number:'1.2-2'}}</span>
                      <span *ngSwitchCase="'deliveredQuantity'"> {{rowData[col.field]}} </span>
                      <span *ngSwitchDefault> {{rowData[col.field]}} </span>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
      </p-tabPanel>
      <p-tabPanel  header="{{'production-order-material-list'|translate}}">
        <div class="row justify-content-end">
          <button pButton type="button" style="margin-right: 15px;"
          icon="fa fa-refresh" name="refresh" (click)="initialize(jobDetail.prodOrderId)"></button>
        </div>
        <div class="row">
            <div class="col-md-12">
              <p-table class="ui-modal-table" [value]="jobDetail.prodOrderMaterialList">
                <ng-template pTemplate="header">
                    <tr>
                        <th>{{'production-order-material-id' | translate}}</th>
                        <th>{{'stock-no' | translate}}</th>
                        <th>{{'stock-name' | translate}}</th>
                        <th>{{'output-rate' | translate}}</th>
                        <th>{{'planned-quantity' | translate}}</th>
                        <th>{{'produced-quantity' | translate}}</th>
                        <th>{{'quantity-unit' | translate}}</th>
                        <th>{{'combine-prod-order-id' | translate}}</th>
                        <th>{{'combine-job-order-id' | translate}}</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData>
                    <tr>
                        <td>{{rowData.prodOrderMaterialId}}</td>
                        <td><a href="javascript:;" (click)="showMaterialDetail(rowData.material?.stockId)">{{rowData.material?.stockNo}}</a></td>
                        <td><a href="javascript:;" (click)="showMaterialDetail(rowData.material?.stockId)">{{rowData.material?.stockName}}</a></td>
                        <td>{{rowData.outputRate}}</td>
                        <td>{{rowData.quantity}}</td>
                        <td>{{rowData.producedQuantity}}</td>
                        <td>{{rowData.quantiyUnit}}</td>
                        <td><a href="javascript:;" (click)="showProdOrderDetail(rowData.combinedProdOrderId)">{{rowData.combinedProdOrderId}}</a></td>
                        <td><a href="javascript:;" (click)="showJobOrderDetail(rowData.combinejobOrderId)">{{rowData.combinejobOrderId}}</a></td>

                    </tr>
                </ng-template>
            </p-table>
        </div>
      </div>
      </p-tabPanel>
      <p-tabPanel header="{{'costing' | translate}}">
        <div class="row">
          <div class="col-lg-12">
            <table class="table table-bordered">
              <tbody>
                <tr>
                  <td class="text-bold" width="30%">{{'estimated-cost' | translate}}</td>
                  <td>
                    {{jobDetail.estimatedCost ? jobDetail.estimatedCost.toFixed(2) : ''}}
                  </td>
                </tr>
                <tr>
                  <td class="text-bold" width="30%">{{'actual-cost' | translate}}</td>
                  <td>
                    {{jobDetail.actualCost ? jobDetail.actualCost.toFixed(2) : ''}}
                  </td>
                </tr>
                <tr>
                  <td class="text-bold" width="30%">{{'final-cost' | translate}}</td>
                  <td>
                    {{jobDetail.finalCost ? jobDetail.finalCost.toFixed(2) : ''}}
                  </td>
                </tr>
                <tr>
                  <td class="text-bold" width="30%">{{'currency' | translate}}</td>
                  <td>
                    {{jobDetail.currency}}
                  </td>
                </tr>
                <tr>
                  <td class="text-bold" width="30%">{{'cost-center' | translate}}</td>
                  <td>
                    {{jobDetail.costCenter?.costCenterName}}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="{{'document'| translate }}">
        <div class="card">
          <div class="card-header">
            <i class="fa fa-align-justify"></i>{{'other-details' | translate}}
          </div>
          <div class="card-body">
            <table class="table table-bordered">
              <tbody>
              <tr align="center">
                <td class="text-center" colspan="2">
                  <image-viewer></image-viewer>
                </td>
              </tr>

              </tbody>
            </table>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="{{'reports'|translate}}" >
        <ng-template pTemplate="content">
          <app-production-stock-reports [plantId]="this.pageFilter.plantId"
          [prodOrderId]="jobDetail.prodOrderId" [finishDate]="finishDate"></app-production-stock-reports>
        </ng-template>
      </p-tabPanel>
    </p-tabView>
  </div>


  <ng-template [ngIf]="dialog.visible">
    <p-dialog class="custom-dialog" [blockScroll]="true"
       [(visible)]="dialog.visible"
      [style]="{'min-width': '90%'}"    [maximizable]="true" #dOrderDetails
      [contentStyle]="{'min-height':'60vh'}" [focusOnShow]="false" modal="true" dismissableMask="true">
      <p-header>
        <div class="d-flex justify-content-between">
          <div class="position-absolute font-weight-bold">{{'tree-view' | translate}}</div>
          <div (click)="isProcessMaterial=!isProcessMaterial;" style="position: absolute; align-items: center;display: flex; cursor:pointer; right: 49%;">
            <div [ngClass]="{'muted-value': !isProcessMaterial}" style="width: 40px; height: 20px; background-color: #94618f;"></div>
            <span [ngClass]="{'muted-value': !isProcessMaterial}" class="mr-2">Process Material</span>
          </div>
          <div (click)="isSemiFinished=!isSemiFinished;" style="position: absolute; align-items: center;display: flex; cursor:pointer; right: 38%;">
            <div [ngClass]="{'muted-value': !isSemiFinished}" style="width: 40px; height: 20px; background-color: #25b7e8;"></div>
            <span [ngClass]="{'muted-value': !isSemiFinished}" class="mr-2">Semi Finished</span>
          </div>
          <div (click)="isRawMaterial=!isRawMaterial;" style="position: absolute; align-items: center;display: flex; cursor:pointer; right: 27%;">
            <div [ngClass]="{'muted-value': !isRawMaterial}" style="width: 40px; height: 20px; background-color: #e87625;"></div>
            <span [ngClass]="{'muted-value': !isRawMaterial}" class="mr-2">Raw Material</span>
          </div>
          <div style="position: absolute;right: 14%;">
            <div class="field-checkbox">
              <p-checkbox [(ngModel)]="showComponentChecked" [binary]="true" [inputId]="'showComponent'"></p-checkbox>
              <label [for]="'showComponent'" class="m-0 ml-2">{{'show-components' |translate}}</label>
            </div>
          </div>
          <div style="position: absolute;right: 10px;margin-right: 44px;top: 8px;">
            <button pButton style="margin-right: 5px" class="ui-button-warning float-right" type="button"  icon="fa fa-file-alt" iconPos="left"
            [label]="'export-as-pdf'|translate"
            (click)="exportPDF()"></button>
          </div>
        </div>
      </p-header>
      <div class="d-flex col-lg-12 align-items-center"  style="min-height: 50vh;">
        <p-tree [value]="TreeViewFiles" layout="horizontal" selectionMode="single" [(selection)]="selectedTreeViewFile"
        [style]="{'background-color': '#f4f4f4'}" id="product-tree-content">
          <ng-template let-node  pTemplate="default">
            <div class="d-flex flex-column" (click)="selectedTreeViewFile=node;openProductTreePanel.toggle($event);">
              <span style="font-weight:bold">{{node.label}}</span>
              <span>
                <ng-container *ngFor="let op of node.data?.jobOrderOperations">
                  <ng-container *ngFor="let comp of op.jobOrderStockProduceList; last as last;">
                    <span [pTooltip]="comp?.stockNo" appendTo="body" [tooltipZIndex]="999999" tooltipPosition="top">
                      {{comp?.stockNo}} - {{comp?.stockName}} </span>
                    <span *ngIf="!last">,<br /></span>
                  </ng-container>
                </ng-container>
                <div><b>JO</b>: {{ node?.data?.jobOrderId }}</div>

                <div><b>JOO</b>:
                   <ng-container *ngFor="let data of node?.data?.jobOrderOperations; let isLast = last">
                     {{ data?.jobOrderOperationId }}<span *ngIf="!isLast">,</span>
                   </ng-container>
                </div>
              </span>
              <span *ngIf="showComponentChecked">
                <br />
                {{'components'| translate}}: <br />
                <ng-container *ngFor="let op of node.data?.jobOrderOperations">
                  <ng-container *ngFor="let comp of op.jobOrderStockUseList; last as last;">
                    <ng-container *ngIf="((comp?.stockTypeId== 9) && isProcessMaterial)
                    || ((comp?.stockTypeId== 2) && isSemiFinished)
                    || ((comp?.stockTypeId== 1) && isRawMaterial)">
                      <span [pTooltip]="comp?.stockNo" appendTo="body" [tooltipZIndex]="999999"
                      tooltipPosition="top"
                      [ngStyle]="{'color': ((comp.stockTypeId === 1) ? '#e87625' : ((comp.stockTypeId === 2) ? '#25b7e8' : ((comp.stockTypeId === 9) ? '#94618f' : '')))}">
                        {{comp?.stockNo}} - {{comp?.stockName}} </span>
                      <span *ngIf="!last">,<br /></span>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </span>
            </div>

            <!-- <input [(ngModel)]="node.label" type="text" style="width:100%"> -->
          </ng-template>
        </p-tree>
      </div>
    </p-dialog>
  </ng-template>


  <p-overlayPanel #openProductTreePanel [showCloseIcon]="true" [style]="{'width': '30%'}" appendTo="body" baseZIndex="9999">

    <ng-template pTemplate>
      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="level"> {{'step-no' | translate}}</label>
        <div class="col-md-7">
          {{selectedTreeViewFile.data.orderFNo}}
        </div>
      </div>

      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="length"> {{'job-order-id' | translate}}</label>
        <div class="col-md-7">
            <!-- {{op.jobOrderOperationId}} -->
            <a href="javascript:;" (click)="showJobOrderDetail(selectedTreeViewFile?.data?.jobOrderId);openProductTreePanel.hide()">
              {{selectedTreeViewFile?.data?.jobOrderId}}
            </a>
        </div>
      </div>

      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="length"> {{'job-order-operation-id' | translate}}</label>
        <div class="col-md-7">
          <ng-container *ngFor="let op of selectedTreeViewFile.data.jobOrderOperations; last as last;">
            <!-- {{op.jobOrderOperationId}} -->
            <a href="javascript:;" (click)="showJobOrderOperationDetail(op.jobOrderOperationId); openProductTreePanel.hide()">
              {{op.jobOrderOperationId}}
            </a>
            <span *ngIf="!last">,<br /></span>
          </ng-container>
        </div>
      </div>
      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="operation"> {{'operation' | translate}}</label>
        <div class="col-md-7">
          <ng-container *ngFor="let op of selectedTreeViewFile.data.jobOrderOperations; last as last;">
            {{op.operation.operationNo}} - {{op.operation.operationName}}
            <span *ngIf="!last">,<br /></span>
          </ng-container>
        </div>
      </div>
      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="length"> {{'planned-start' | translate}}</label>
        <div class="col-md-7">
          {{selectedTreeViewFile.data.startDate|date:"dd/MM/yyyy HH:mm:ss"}}
        </div>
      </div>
      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="length"> {{'planned-finish' | translate}}</label>
        <div class="col-md-7">
          {{selectedTreeViewFile.data.finishDate|date:"dd/MM/yyyy HH:mm:ss"}}
        </div>
      </div>
      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="length"> {{'job-order-status' | translate}}</label>
        <div class="col-md-7">
          {{selectedTreeViewFile.data.jobOrderStatus}}
        </div>
      </div>
      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="operation"> {{'component-output' | translate}}</label>
        <div class="col-md-7">
          <ng-container *ngFor="let op of selectedTreeViewFile.data.jobOrderOperations">
            <ng-container *ngFor="let comp of op.jobOrderStockProduceList; last as last;">
              <span [pTooltip]="'Quantity: ' +comp?.quantity" appendTo="body" [tooltipZIndex]="99999999" tooltipPosition="top">
                {{comp?.stockNo}} - {{comp?.stockName}} </span>
              <span *ngIf="!last">,<br /></span>
            </ng-container>
          </ng-container>
        </div>
      </div>
      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="operation"> {{'component-input' | translate}}</label>
        <div class="col-md-7">
          <ng-container *ngFor="let op of selectedTreeViewFile.data.jobOrderOperations">
            <ng-container *ngFor="let comp of op.jobOrderStockUseList; last as last;">
              <span [pTooltip]="'Quantity: ' +comp?.quantity" appendTo="body" [tooltipZIndex]="99999999"
              [ngStyle]="{
                'color': ((comp.stockTypeId === 1) ? '#e87625' : ((comp.stockTypeId === 2) ? '#25b7e8' : ((comp.stockTypeId === 9) ? '#94618f' : '')))
              }"
              tooltipPosition="top">
                {{comp?.stockNo}} - {{comp?.stockName}} </span>
              <span *ngIf="!last">,<br /></span>
            </ng-container>
          </ng-container>
        </div>
      </div>

      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="operation"> {{'planned-single-duration' | translate}}</label>
        <div class="col-md-7">
          <ng-container *ngFor="let op of selectedTreeViewFile.data.jobOrderOperations">
            {{getReadableTime(op.singleDuration)}}
          </ng-container>
        </div>
      </div>
      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="operation"> {{'single-total-duration' | translate}}</label>
        <div class="col-md-7">
          <ng-container *ngFor="let op of selectedTreeViewFile.data.jobOrderOperations">
            {{getReadableTime(op.singleTotalDuration)}}
          </ng-container>
        </div>
      </div>
      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="operation"> {{'planned-cost' | translate}}</label>
        <div class="col-md-7">
          <ng-container *ngFor="let op of selectedTreeViewFile.data.jobOrderOperations">
            {{op.variableCost}}
          </ng-container>
        </div>
      </div>
      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="operation"> {{'planned-cost' | translate}}</label>
        <div class="col-md-7">
          <ng-container *ngFor="let op of selectedTreeViewFile.data.jobOrderOperations">
            {{op.currency}}
          </ng-container>
        </div>
      </div>

      <!-- <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="operation"> {{'order-no' | translate}}</label>
        <div class="col-md-7">
          <ng-container *ngFor="let op of selectedTreeViewFile.data.jobOrderOperations">
            {{op.operationOrder}}
          </ng-container>
        </div>
      </div> -->
      <div class="form-group row align-items-center">
        <label class="col-md-5 col-form-label font-weight-bold" for="operation"> {{'workstation' | translate}}</label>
        <div class="col-md-7">
          <ng-container *ngFor="let op of selectedTreeViewFile.data.jobOrderOperations; last as last;">
              <span>{{op.workStation?.workStationName}} </span>
              <span *ngIf="!last">,<br /></span>
          </ng-container>
        </div>
      </div>
      <!-- <div class="form-group row">
        <label class="col-md-4 col-form-label" for="operation"> {{'operation' | translate}}</label>
        <div class="col-md-8">
          <ng-container *ngFor="let op of selectedTreeViewFile.jobOrderOperations">
            {{op.operation.operationNo}}-{{op.operation.operationName}},
          </ng-container>
        </div>
      </div> -->
    </ng-template>
  </p-overlayPanel>


  <ng-template [ngIf]="modal.active">
    <div bsModal [config]="{backdrop: 'static', keyboard: false, show: true}" #myModal="bs-modal" (onHidden)="selectedReservationRow=null;modal.active=false;"
      class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-success" [ngStyle]="{'max-width':'100%'}" role="document">
        <div class="modal-content">

          <div class="modal-header">
            <h4 class="modal-title"> {{'advanced-stock-reports' | translate}}</h4>
            <button type="button" class="close" (click)="myModal.hide()" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

          <div class="modal-body">
              <advanced-stock-report-list [filteredData]="selectedReservationRow"></advanced-stock-report-list>
          </div>

          <div class="modal-footer">

            <button type="button" style="background:lightslategray;" class="btn rounded btn-outline-secondary"
              (click)="myModal.hide()">{{'close' | translate}}
            </button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
  </ng-template>

  <ng-template [ngIf]="editModal.active">
    <div bsModal [config]="{backdrop: 'static', keyboard: false, show: true}" #myModal="bs-modal" (onHidden)="selectedReservationRow=null;editModal.active=false;"
      class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-success modal-lg" role="document">
        <div class="modal-content">

          <div class="modal-header">
            <h4 class="modal-title"> {{'reservation' | translate}}</h4>
            <button type="button" class="close" (click)="myModal.hide()" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

          <div class="modal-body">
              <reservation-edit [id]="selectedReservationRow?.reservationId" (saveAction)="myModal.hide();initialize(prodOrderId);"></reservation-edit>
          </div>

          <div class="modal-footer">

            <button type="button" style="background:lightslategray;" class="btn rounded btn-outline-secondary"
              (click)="myModal.hide()">{{'close' | translate}}
            </button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
  </ng-template>


  <p-dialog header="{{panel.title | translate}}" appendTo="body" [(visible)]="panel.visible" [autoZIndex]="true" [baseZIndex]="999999"
  #dJoin (onHide)="OnDivideHide()" [style]="{'width': panel.title==='next-job-order'? '40%': '50%'}" [contentStyle]="{'min-height':'260px'}">
  <div class="col-md-12" *ngIf="panel.title==='update-long-term-processing'">
    <table class="table table-bordered">
      <tbody>
        <tr>
          <td>{{'job-order-id' | translate}}</td>
          <td>
            {{this.panel.data?.jobOrderId}}
          </td>
        </tr>
        <tr>
          <td>{{'job-order-operation-id'| translate}}</td>
          <td>
            {{this.panel.data?.jobOrderOperationId}}
          </td>
        </tr>
        <tr>
          <td>{{'start-date'|translate}}</td>
          <td>
            <p-calendar [monthNavigator]="true" [yearNavigator]="true" yearRange="1990:2100" [showTime]="true"
            [showIcon]="true" name="startDate" dateFormat="dd/mm/yy" appendTo="body" [baseZIndex]="99999999"
            [(ngModel)]="reqChangeJobOrderOperationStatusDto.startDate"
            placeholder="{{'start-date'|translate}}"></p-calendar>
            <!-- <p-calendar [(ngModel)]="reqChangeJobOrderOperationStatusDto.startDate" [showIcon]="true" [showTime]="true" [style]="{'overflow': 'visible', 'z-index': '19999','opacity':'1'}" inputId="startDate"></p-calendar> -->
          </td>
        </tr>
        <tr>
          <td>{{'finish-date' |  translate}}</td>
          <td>
            <p-calendar [monthNavigator]="true" [yearNavigator]="true" yearRange="1990:2100" [showTime]="true"
            [showIcon]="true" name="finishDate" dateFormat="dd/mm/yy" appendTo="body" [baseZIndex]="99999999"
            [(ngModel)]="reqChangeJobOrderOperationStatusDto.finishDate"
            placeholder="{{'finish-date'|translate}}"></p-calendar>
            <!-- <p-calendar [(ngModel)]="reqChangeJobOrderOperationStatusDto.finishDate" [showIcon]="true" [showTime]="true" [style]="{'overflow': 'visible', 'z-index': '9999','opacity':'1'}" inputId="finishDate"></p-calendar> -->
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <button class="btn btn-danger float-right" (click)="panel.visible=false;">{{'close' | translate}}</button>
            <button class="btn btn-primary float-right" (click)="jobOrderChangeStatus()">
            {{'save' | translate}}</button>

          </td>
        </tr>
      </tbody>
    </table>
  </div>


  <div class="col-md-12" *ngIf="panel.title==='divide-job-order'">
    <label>{{'total-quantity' | translate}} : {{panel.data.quantity}}</label>
    <p-tabView>
      <p-tabPanel header="{{'manual-division' | translate}}">
        <div class="form-group row">
          <label class="col-md-3 col-form-label" for="manual">{{'number-of-jobs' | translate }}</label>
          <div class="col-md-6">
            <div class="input-group">

              <select id="manual" name="manual" class="form-control" [(ngModel)]="params.numberOfJobs"
                (change)="selectDivideJobs()">
                <option [ngValue]="null"> {{'please-select' | translate}}</option>
                <option *ngFor="let no of [2,3,4,5,6,7,8,9,10]" value="{{no}}">{{no}}</option>
              </select>

            </div>
          </div>
        </div>

        <div class="form-group row mb-1" *ngFor="let item of params.jobList">
          <label class="col-md-3 col-form-label" for="manual">{{item.name}}. {{'job' | translate}} </label>
          <div class="col-md-6">
            <div class="input-group">
              <input class="form-control" type="number" [(ngModel)]="item.value">
            </div>
          </div>
        </div>
        <button [disabled]="!params.jobList || params.jobList.length==0" class="btn btn-success"
          (click)="divideJobs('manual')">{{'save' | translate}}
        </button>
        <div *ngIf="params.error" class="row alert alert-dismissible alert-warning">
          {{params.error}}
        </div>

      </p-tabPanel>
      <p-tabPanel header="{{'auto-division' | translate}}">
        <div class="form-group row">
          <label class="col-md-3 col-form-label" for="auto">{{'number-of-jobs' | translate }}</label>
          <div class="col-md-6">
            <div class="input-group">

              <select id="auto" name="auto" class="form-control" [(ngModel)]="params.numberOfJobs"
                (change)="selectDivideJobs()">
                <option [ngValue]="null"> {{'please-select' | translate}}</option>
                <option *ngFor="let no of [2,3,4,5,6,7,8,9,10]" value="{{no}}">{{no}}</option>
              </select>
            </div>
          </div>
        </div>
        <button [disabled]="!params.numberOfJobs|| params.numberOfJobs==0" class="btn btn-success"
          (click)="divideJobs('auto')">{{'save' | translate}}
        </button>
      </p-tabPanel>
    </p-tabView>
  </div>

  <div class="col-md-12" *ngIf="panel.title==='next-job-order'">
    <div class="card">
      <div class="card-header">
          {{'update-next-job-order-id' | translate}}
      </div>
      <div class="card-body">
        <div class="col-md-12">
          <table class="table table-bordered">
            <tr>
              <td>
                {{" * "}} {{'left' | translate }} {{" - "}} {{'previous' | translate }} <br>
                {{" * "}} {{'right' | translate }} {{" - "}} {{'next' | translate }}
              </td>
            </tr>
            <tr>
              <td class="text-center">
                <div class="col-md-12 border d-flex align-items-center" style="min-height: 120px;">
                  <span *ngFor="let jobOrder of selectedJobOrderList; let i=index;">
                    <ng-container *ngIf="i!==0">{{" -> "}}</ng-container>
                    {{jobOrder.jobOrderId}} {{" "}}
                  </span>
                </div>
              </td>
            </tr>
            <tr>
              <td>
                <button class="btn btn-primary float-right" (click)="nextJobOrderCall()">
                  {{'confirm' | translate}}
                </button>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
  <!-- <div class="col-md-12" *ngIf="panel.title=='combine-job-orders'">

    <job-order-join [selectedReadyJobOrders]="selectedReadyJobOrders" (saveAction)="joinSaved()"></job-order-join>
  </div> -->


</p-dialog>
