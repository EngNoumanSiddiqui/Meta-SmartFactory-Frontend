<p-confirmDialog [autoZIndex]="true" [baseZIndex]="999999"></p-confirmDialog>
<div class="animated fadeIn">
  <div class="card">

    <div class="card-body">
      <div class="row">
        <div class="col-lg-12">

          <div class="col-md-12">
            <div class="row ">
              {{'waiting-job-orders' | translate}}
            </div>
            <hr>
            <div class="row ui-fluid badge-light border border-bottom-0 m-minus-10 p-2">
              <div class="col-md-2">
                <span class="ui-float-label ml-1 ">
                  <input id="float-jobOrderId" type="text" pInputText (input)="searchReadyJobs()"
                    [(ngModel)]="readyJobsPageFilter.jobOrderId">
                  <label for="float-material">{{'job-order-id'|translate}}</label>
                </span>
              </div>

              <!--              <div class="col-md-2 px-0 mx-0 text-left">-->
              <!--                <order-detail-auto-complete [multiple]="true"-->
              <!--                                            (selectedOrderDetailEvent)="searchReadyJobsForOrderDetail($event)"></order-detail-auto-complete>-->
              <!--              </div>-->
              <div class="col-md-2">
                <span class="ui-float-label ml-1 ">
                  <input id="float-material" type="text" pInputText (input)="searchReadyJobs()"
                    [(ngModel)]="readyJobsPageFilter.stockToProduceName">
                  <label for="float-material">{{'material'|translate}}</label>
                </span>

              </div>
              <div class="col">
                <span class="ui-float-label ml-1 ">
                  <input id="float-joperationOrder1" type="text" pInputText
                    [(ngModel)]="readyJobsPageFilter.jobOrderOperationId" (input)="searchReadyJobs()">
                  <label for="float-joperationOrder1">{{'job-order-operation-id'|translate}}</label>
                </span>
              </div>
              <div class="col-md-2">
                <span class="ui-float-label ml-1 ">
                  <input id="float-operationName" type="text" pInputText (input)="searchReadyJobs()"
                    [(ngModel)]="readyJobsPageFilter.operationUseName">
                  <label for="float-operationName">{{'operation'|translate}}</label>
                </span>
              </div>
              <div class="col-md-2">
                <span class="ui-float-label ml-1 ">
                  <input id="float-referenceId" type="text" pInputText (input)="searchReadyJobs()"
                    [(ngModel)]="readyJobsPageFilter.prodOrderReferenceId">
                  <label for="float-referenceId">{{'reference-id'|translate}}</label>
                </span>
              </div>
              <div class="col">
                <button pButton type="button" class="float-right" icon="fa fa-refresh" name="refresh"
                  (click)="searchReadyJobs()"></button>
              </div>
              <!-- <div class="col-md-1">
                <button type="button" class="btn btn-sm btn-warning btn-block active" style="margin-top: 2px"
                        (click)="resetReadyJobs()">{{'reset' |
                  translate}}
                </button>
              </div> -->
            </div>
          </div>
          <p-table [value]="readyJobOrders" [resizableColumns]="true" [(selection)]="selectedReadyJobOrders" dataKey="jobOrderId"
            scrollable="true" scrollHeight="400px" scrollWidth="100%">

            <ng-template pTemplate="colgroup" let-columns>
              <colgroup>
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
                  <col >
              </colgroup>
          </ng-template>
            <ng-template pTemplate="header">

              <tr class="text-center" style="font-size: 12px">
                <th style="width: 4em;">
                  <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                </th>
                <th pResizableColumn>{{'prod-order-id' | translate}}</th>
                <th pResizableColumn>{{'job-order-id' | translate}}</th>
                <th pResizableColumn>{{'job-order-operation-id' | translate}}</th>
                <th pResizableColumn>{{'reference-id' | translate}}</th>
                <th pResizableColumn style="width: 100px;">{{'operation' | translate}}</th>
                <th pResizableColumn style="width: 110px;">{{'material-input' | translate}}</th>
                <th pResizableColumn style="width: 110px;">{{'material-output' | translate}}</th>
                <th pResizableColumn width="85px">{{'workstation' | translate}}</th>
                <th pResizableColumn style="width: 4em;">{{'qt' | translate}}</th>
                <th pResizableColumn style="width: 40px;">{{'parent' | translate}}</th>

                <th pResizableColumn>{{'position' | translate}}</th>
                <th pResizableColumn>{{'status' | translate}}</th>
                <th pResizableColumn>{{'value' | translate}}</th>
                <th pResizableColumn width="70px">{{'individual-capacity' | translate}}</th>

                <th pResizableColumn>{{'planned-start' | translate}}</th>
                <th pResizableColumn>{{'planned-finish' | translate}}</th>
                <th pResizableColumn width="90px">{{'start-date' | translate}}</th>

              </tr>
              <!-- <tr>
                <th colspan="7"></th>
                <th colspan="1">
                  <input style="width: 100%;" [(ngModel)]="readyJobsPageFilter.jobOrderStatus" pInputText type="text"
                    (input)="filterByColumn($event.target.value,'jobOrderStatus')">
                </th>
                <th colspan="7"></th>
              </tr> -->

            </ng-template>
            <ng-template pTemplate="body" let-rowData let-index="rowIndex" >
              <tr [pSelectableRow]="rowData">
                <td style="width: 4em;" class="ui-resizable-column">
                  <b>
                    <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
                  </b>
<!--                  <a href="#" [pRowToggler]="rowData">-->
<!--                    <i [ngClass]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></i>-->
<!--                  </a>-->
                </td>

                <td class="ui-resizable-column">
                  <a href="javascript:;"
                    (click)="showProdOrderDetail(rowData.prodOrder.prodOrderId)">{{rowData.prodOrder?.prodOrderId}}</a>
                </td>
                <td class="ui-resizable-column">
                  <a href="javascript:;" (click)="showJobOrderDetail(rowData.jobOrderId)">{{rowData.jobOrderId}}</a>
                </td>
                <td class="ui-resizable-column" style="padding: 0px;">
                  <!-- [style.height]="getOperationDataHeight(operation).height + 'px'" -->
                  <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                    <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent"
                    [style.height]="getOperationDataHeight(operation).height + 'px'">
                        <li>
                          <a class="nowraptext" href="javascript:;" (click)="showJobOrderOperationDetail(operation.jobOrderOperationId)">
                            {{operation.jobOrderOperationId}}</a>
                          <!-- {{operation.jobOrderOperationId}} -->
                        </li>
                    </ul>
                  </ng-container>
                </td>
                <!-- <td><a href="javascript:;"
                    (click)="showOrderDetail(rowData.orderDetail?.orderId)">{{rowData.orderDetail?.orderId}}</a>
                </td> -->

                <td class="ui-resizable-column">
                  {{rowData.prodOrder?.referenceId}}
                </td>

                <td class="ui-resizable-column" style="width: 100px; padding: 0;">
                  <!-- [style.height]="getOperationDataHeight(operation).height + 'px'" -->
                  <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                    <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent"
                    [style.height]="getOperationDataHeight(operation).height + 'px'">
                        <li>
                          <a href="javascript:;" (click)="showOperationDetail(operation.operationId)"
                          pTooltip="{{operation.operationName}}" tooltipPosition="top">{{operation.operationName}}</a>
                        </li>
                    </ul>
                  </ng-container>
                </td>

                <td class="ui-resizable-column" style="width: 110px; padding: 0;">
                  <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                    <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent"
                    [style.height]="getOperationDataHeight(operation).height + 'px'"
                    >
                    <!-- [style.height]="(getOperationDataHeight(operation).height/getOperationDataHeight(operation).totalHeight) + 'px'" -->
                        <li *ngFor="let item of operation.jobOrderStockUseList; last as jLast"
                        >
                          <a href="javascript:;" (click)="showStockDetail(item.stockId)"
                          pTooltip="{{item.stockName}}" tooltipPosition="top">{{item.stockName}}</a>
                        </li>
                    </ul>
                  </ng-container>
                </td>


                <td class="ui-resizable-column" style="width: 110px; padding: 0;">
                  <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                    <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent"
                    [style.height]="getOperationDataHeight(operation).height + 'px'">
                    <!-- [style.height]="(getOperationDataHeight(operation).height/getOperationDataHeight(operation).totalHeight) + 'px'" -->
                        <li *ngFor="let item of operation.jobOrderStockProduceList"
                        >
                          <a href="javascript:;" (click)="showStockDetail(item.stockId)"
                          pTooltip="{{item.stockName}}" tooltipPosition="top">{{item.stockName}}</a>
                        </li>
                    </ul>
                  </ng-container>
                </td>
                <td class="ui-resizable-column" style="padding: 0; width: 85px;">
                  <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast; let wrkIndex=index">
                    <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent"
                    [style.height]="getOperationDataHeight(operation).height + 'px'">
                        <li>
                          <ng-container *ngIf="!operation.workStation && operation.parent" >
                            <span class="text-center"
                            (click)="openPanel(rowData,'workstation', wrkIndex);myModal.show()">
                            <i class="fa fa-plus-circle" aria-hidden="true"></i></span>
                          </ng-container>
                          <ng-container *ngIf="operation.workStation">
                            <a href="javascript:;"
                              (click)="openPanel(rowData,'workstation', wrkIndex);myModal.show()"
                              pTooltip="{{operation.workStation?.workStationName}}" tooltipPosition="top">{{operation.workStation?.workStationName}}</a>
                          </ng-container>
                        </li>
                    </ul>
                  </ng-container>
                </td>


               <td class="ui-resizable-column" style="padding: 0; width: 4em;">
                  <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                    <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent"
                    [style.height]="getOperationDataHeight(operation).height + 'px'">
                    <!-- [style.height]="(getOperationDataHeight(operation).height/getOperationDataHeight(operation).totalHeight) + 'px'" -->
                        <li *ngFor="let item of operation.jobOrderStockProduceList" >
                          <span>{{item.neededQuantity}}</span>
                        </li>
                    </ul>
                  </ng-container>
                </td>
                <td class="ui-resizable-column" style="padding: 0; width: 40px;">
                  <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                    <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent"
                    [style.height]="getOperationDataHeight(operation).height + 'px'">
                    <!-- style="padding-left: 5px;" -->
                        <li >
                          {{operation.parent ? 'Yes' : 'No'}}
                        </li>
                    </ul>
                  </ng-container>
                </td>

                <!-- <td> {{rowData.quantity}}</td> -->
                <td class="ui-resizable-column"> {{rowData.position|translate}}</td>
                <td class="ui-resizable-column"> {{rowData.jobOrderStatus|translate}}</td>
                <td class="ui-resizable-column" style="padding: 0;">
                  <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                    <ul style="word-break: break-all;" [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent" [style.height]="getOperationDataHeight(operation).height + 'px'">
                        <li>
                          {{operation.totalCost ? operation.totalCost.toFixed(2) : ''}}
                        </li>
                    </ul>
                  </ng-container>
                </td>
                <td class="ui-resizable-column" width="70px">
                  <ng-container *ngFor="let operation of rowData?.jobOrderOperations; let operationIndex=index; last as oLast">
                    <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent"
                    [style.height]="getOperationDataHeight(operation).height + 'px'">
                    <!-- style="padding-left: 5px;" -->
                        <li >
                          <input name="individual-capacity{{operationIndex}}" [(ngModel)]="operation.individualCapacity" type="number"
                          class="form-control">
                        </li>
                    </ul>
                  </ng-container>

                </td>
                <!-- <td width="100px" style="cursor: pointer">
                  <div *ngIf="!rowData.workStation" class="text-center"
                    (click)="openPanel(rowData,'workstation');myModal.show()">
                    <i class="fa fa-plus-circle" aria-hidden="true"></i>
                  </div>
                  <div *ngIf="rowData.workStation">
                    <a href="javascript:;"
                      (click)="openPanel(rowData,'workstation');myModal.show()">{{rowData.workStation?.workStationName}}</a>
                  </div>
                </td> -->
                <td class="ui-resizable-column"> {{rowData.startDate|date:"dd/MM/yyyy HH:mm:ss"}}</td>
                <td class="ui-resizable-column"> {{rowData.finishDate|date:"dd/MM/yyyy HH:mm:ss"}}</td>

                <td class="ui-resizable-column" width="90px" style="cursor: pointer">
                  <p-calendar class="ui-fluid" [(ngModel)]="rowData.startDate" dateFormat="dd/mm/yy" showTime="showTime"
                    hourFormat="24" [monthNavigator]="true" [yearNavigator]="true" yearRange="2020:2100"
                    [minDate]="minDateValue" appendTo="body"></p-calendar>
                </td>
              </tr>
            </ng-template>

          </p-table>
          <div
            class=" col-lg-12 badge-light border border-bottom-0 m-minus-10 p-2 d-flex flex-row justify-content-center">


            <button type="button" class="btn btn-sm btn-success ml-2" (click)="loadJobs()" [disabled]=" !selectedReadyJobOrders || selectedReadyJobOrders.length<1">{{'plan-job-orders' |
              translate}}
            </button>

            <button type="button" class="btn btn-sm btn-success ml-2" (click)="openDivideDialog()" [disabled]=" !selectedReadyJobOrders || selectedReadyJobOrders.length<1">
              {{'divide-job-order'| translate}}
            </button>

            <button type="button" [disabled]=" !selectedReadyJobOrders || selectedReadyJobOrders.length<2"
              class="btn btn-sm btn-success ml-2" (click)="openJoinDialog()">{{'combine-job-orders' |
              translate}}
            </button>
            <button class="btn btn-sm btn-danger ml-2" type="button" (click)="cancelReadyAllJobOrder()" [disabled]="selectedReadyJobOrders?.length < 1">
                  {{'cancel'|translate}} {{'job-orders'|translate}}
            </button>
          </div>

          <div class="row">
            <app-paging [showSearch]="false" [TotalElements]="readyPagining.totalElements"
              [CurrentPage]="readyPagining.currentPage" [PageSize]="readyPagining.pageSize" [rows]="readyPagining.rows"
              [TotalPageLinkButtons]="readyPagining.TotalPageLinkButtons"
              [RowsPerPageOptions]="readyPagining.RowsPerPageOptions"
              (onPageChange)="jobListPageChange($event, readyPagining, 'ready')"></app-paging>
            <span style="margin-left:2px; padding-top: 2px " class="text-muted">{{'total-records'|translate}}:
              {{readyPagining?.totalElements}}</span>
          </div>
        </div>


      </div>
      <hr>

      <!--Planned JOb-->
      <div class="row">

        <div class="col-lg-12">

          <div class="col-md-12">
            <div class="row ">
              {{'planned-jobs' | translate}}
            </div>
            <div class="row ui-fluid badge-light border border-bottom-0 m-minus-10 p-2">
              <div class="col">
                <span class="ui-float-label ml-1 ">
                  <input id="float-jworkstationName" type="text" pInputText
                    [(ngModel)]="plannedJobsPageFilter.workStationName" (input)="searchPlannedJobs()">
                  <label for="float-material">{{'workstation'|translate}}</label>
                </span>
              </div>
              <div class="col">
                <span class="ui-float-label ml-1 ">
                  <input id="float-jjobOrderId" type="text" pInputText [(ngModel)]="plannedJobsPageFilter.jobOrderId"
                    (input)="searchPlannedJobs()">
                  <label for="float-material">{{'job-order-id'|translate}}</label>
                </span>
              </div>

              <!--              <div class="col px-0 text-left">-->
              <!--                <order-detail-auto-complete [multiple]="true"-->
              <!--                                            (selectedOrderDetailEvent)="searchPlannedJobsForOrderDetail($event)"></order-detail-auto-complete>-->
              <!--              </div>-->
              <div class="col">
                <span class="ui-float-label ml-1 ">
                  <input id="float-jmaterial" type="text" pInputText [(ngModel)]="plannedJobsPageFilter.stockToProduceName"
                    (input)="searchPlannedJobs()">
                  <label for="float-jmaterial">{{'material'|translate}}</label>
                </span>

              </div>
              <div class="col">
                <span class="ui-float-label ml-1 ">
                  <input id="float-joperationOrder" type="text" pInputText
                    [(ngModel)]="plannedJobsPageFilter.jobOrderOperationId" (input)="searchPlannedJobs()">
                  <label for="float-joperationOrder">{{'job-order-operation-id'|translate}}</label>
                </span>
              </div>
              <div class="col">
                <span class="ui-float-label ml-1 ">
                  <input id="float-joperationName" type="text" pInputText
                    [(ngModel)]="plannedJobsPageFilter.operationUseName" (input)="searchPlannedJobs()">
                  <label for="float-joperationName">{{'operation'|translate}}</label>
                </span>
              </div>
              <div class="col">
                <span class="ui-float-label ml-1 ">
                  <input id="float-jreferenceId" type="text" pInputText
                    [(ngModel)]="plannedJobsPageFilter.prodOrderReferenceId" (input)="searchPlannedJobs()">
                  <label for="float-jreferenceId">{{'reference-id'|translate}}</label>
                </span>
              </div>


              <div class="col">
                <p-calendar [showIcon]="true" dateFormat="dd.mm.yy" (ngModelChange)="searchPlannedJobs()"
                  [monthNavigator]="true" [yearNavigator]="true" yearRange="1990:2100" showTime="true"
                  [(ngModel)]="plannedJobsPageFilter.startDate" placeholder="{{'start-date'|translate}}"></p-calendar>
              </div>

              <div class="col">
                <p-calendar [showIcon]="true" dateFormat="dd.mm.yy" (ngModelChange)="searchPlannedJobs()"
                  [monthNavigator]="true" [yearNavigator]="true" yearRange="1990:2100" showTime="true"
                  [(ngModel)]="plannedJobsPageFilter.finishDate" placeholder="{{'end-date'|translate}}"></p-calendar>
              </div>
              <div class="col-md-2 p-0">
                <button pButton style="margin-right: 5px" class="ui-button-warning float-right" type="button"
                  icon="fa fa-file" iconPos="left" label="{{'export-all'|translate}}"
                  (click)="exportCSV()"></button>
              </div>
              <div>
                <button pButton type="button" class="float-right" icon="fa fa-refresh" name="refresh"
                  (click)="filterPlannedJObs()"></button>
              </div>
              <!--<div class="col-1">-->
              <!--<button type="button" class="btn btn-sm btn-primary btn-block active" style="margin-top: 2px"-->
              <!--(click)="filterPlannedJObs()">{{'filter' |-->
              <!--translate}}-->
              <!--</button>-->
              <!--</div>-->
            </div>
          </div>


          <p-table [value]="loadedJobs"
          dataKey="jobOrderId" scrollable="true" scrollHeight="400px" [resizableColumns]="true" styleClass="p-datatable-gridlines"
          scrollWidth="100%">

          <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
                <col >
                <col >
                <col >
                <col >
                <col >
                <col >
                <col >
                <col >
                <col >
                <col >
                <col >
                <col >
                <col >
                <col >
                <col >
                <col >
                <col >
            </colgroup>
        </ng-template>

            <ng-template pTemplate="header">
              <tr class="text-center " style="font-size: 12px">
                <th pResizableColumn style="width: 4em"></th>
                <th pResizableColumn>{{'prod-order-id' | translate}}</th>
                <th pResizableColumn>{{'job-order-id' | translate}}</th>
                <th pResizableColumn>{{'job-order-operation-id' | translate}}</th>
                <!-- <th>{{'order-detail-id' | translate}}</th> -->
                <th pResizableColumn>{{'reference-id' | translate}}</th>
                <th pResizableColumn style="width: 100px;">{{'operation' | translate}}</th>
                <th pResizableColumn style="width: 110px;">{{'material-input' | translate}}</th>
                <th pResizableColumn style="width: 110px;">{{'material-output' | translate}}</th>
                <th pResizableColumn width="85px">{{'workstation' | translate}}</th>
                <th pResizableColumn style="width: 4em;">{{'qt' | translate}}</th>
                <th pResizableColumn>{{'position' | translate}}</th>
                <th pResizableColumn>{{'status' | translate}}</th>
                <th pResizableColumn>{{'value' | translate}}</th>
                <th pResizableColumn width="75px">{{'create-date' | translate}}</th>
                <th pResizableColumn width="75px">{{'start-date' | translate}}</th>
                <th pResizableColumn width="75px">{{'finish-date' | translate}}</th>
                <th pResizableColumn width="60px" rowspan="2">{{'action' | translate}}</th>
              </tr>

            </ng-template>
            <ng-template pTemplate="body" let-rowData let-index="rowIndex" >
              <tr>
                <td style="width: 4em;">
<!--                  <a href="#" [pRowToggler]="rowData">-->
<!--                    <i [ngClass]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></i>-->
<!--                  </a>-->
                </td>
                <td><a href="javascript:;"
                    (click)="showProdOrderDetail(rowData.prodOrder.prodOrderId)">{{rowData.prodOrder?.prodOrderId}}</a>
                <td><a href="javascript:;" (click)="showJobOrderDetail(rowData.jobOrderId)">{{rowData.jobOrderId}}</a>
                </td>
                <td style="padding: 0px;">
                  <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                    <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent"
                    [style.height]="getOperationDataHeight(operation).height + 'px'">
                        <li>
                          <a class="nowraptext" href="javascript:;" (click)="showJobOrderOperationDetail(operation.jobOrderOperationId)">
                            {{operation.jobOrderOperationId}}</a>
                          <!-- {{operation.jobOrderOperationId}} -->
                        </li>
                    </ul>
                  </ng-container>
                </td>
                <!-- <td><a href="javascript:;"
                    (click)="showOrderDetail(rowData.orderDetail?.orderId)">{{rowData.orderDetail?.orderId}}</a></td> -->

                <td>{{rowData.prodOrder?.referenceId}}</td>
                    <td style="width: 100px; padding: 0;">
                      <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                        <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent"
                        [style.height]="getOperationDataHeight(operation).height + 'px'">
                            <li>
                              <a href="javascript:;" (click)="showOperationDetail(operation.operationId)"
                              pTooltip="{{operation.operationName}}" tooltipPosition="top"
                              >{{operation.operationName}}</a>
                            </li>
                        </ul>
                      </ng-container>
                    </td>

                    <td style="width: 110px; padding: 0;">
                      <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                        <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent" [style.height]="getOperationDataHeight(operation).height + 'px'">
                          <!-- [style.height]="(getOperationDataHeight(operation).height/getOperationDataHeight(operation).totalHeight) + 'px'" -->
                            <li *ngFor="let item of operation.jobOrderStockUseList; last as jLast" >
                              <a href="javascript:;" (click)="showStockDetail(item.stockId)"
                              pTooltip="{{item.stockName}}" tooltipPosition="top">{{item.stockName}}</a>
                            </li>
                        </ul>
                      </ng-container>
                    </td>


                    <td style="width: 110px; padding: 0;">
                      <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                        <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent" [style.height]="getOperationDataHeight(operation).height + 'px'">
                          <!-- [style.height]="(getOperationDataHeight(operation).height/getOperationDataHeight(operation).totalHeight) + 'px'" -->
                            <li *ngFor="let item of operation.jobOrderStockProduceList" >
                              <a href="javascript:;" (click)="showStockDetail(item.stockId)"
                              pTooltip="{{item.stockName}}" tooltipPosition="top">{{item.stockName}}</a>
                            </li>
                        </ul>
                      </ng-container>
                    </td>

                    <td style="width: 85px; padding: 0;">
                      <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                        <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent" [style.height]="getOperationDataHeight(operation).height + 'px'">
                            <li><a href="javascript:;" (click)="showWorkStationDetail(operation.workStationId)"
                              pTooltip="{{operation.workStationName}}" tooltipPosition="top">{{operation.workStationName}}</a></li>
                        </ul>
                      </ng-container>
                    </td>


                <!-- <td> {{rowData.quantity}}</td> -->
                <td style="padding: 0; width: 4em;">
                  <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                    <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" class="jOrderParent" [style.height]="getOperationDataHeight(operation).height + 'px'">
                      <!-- [style.height]="(getOperationDataHeight(operation).height/getOperationDataHeight(operation).totalHeight) + 'px'" -->
                        <li *ngFor="let item of operation.jobOrderStockProduceList" >
                          <span>{{item.neededQuantity}}</span>
                        </li>
                    </ul>
                  </ng-container>
                </td>
                <!-- <td style="padding: 0;">
                  <table>
                    <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                      <tr [style.borderBottom]="!oLast ? '1px solid #c8c8c8': ''">
                        <td class="input-tooltip" style="display: inherit;">
                          <table>
                            <ng-container *ngFor="let item of operation?.jobOrderStockProduceList; last as isLast">
                              <tr [style.borderBottom]="!isLast ? '1px solid #c8c8c8': ''">
                                <td class="input-tooltip">
                                    {{item.neededQuantity}}
                              </td></tr>
                          </ng-container>
                          </table>

                        </td>
                      </tr>

                    </ng-container>
                  </table>
                </td> -->
                <td> {{rowData.position|translate}}</td>
                <td> {{rowData.jobOrderStatus|translate}}</td>

               <td style="padding: 0;">
                <ng-container *ngFor="let operation of rowData?.jobOrderOperations; last as oLast">
                  <ul [style.borderBottom]="(oLast) ? 'none': '1px solid grey'" 
                  class="jOrderParent" [style.height]="getOperationDataHeight(operation).height + 'px'"
                  style="word-break:break-all;">
                      <li>
                        {{getFixedValue(operation.totalCost)}}
                      </li>
                  </ul>
                </ng-container>
              </td>
                <td width="75px"> {{rowData.createDate|date:'dd-MM-yyyy HH:mm'}}</td>
                <td width="75px"> {{rowData.startDate|date:'dd-MM-yyyy HH:mm:ss'}}</td>
                <td width="75px"> {{rowData.finishDate|date:'dd-MM-yyyy HH:mm:ss'}}</td>
                <td width="60px">
                  <button *ngIf="rowData.jobOrderStatus=='PLANNED'||rowData.jobOrderStatus=='LONG_TERM_PROCESSING'" class="btn btn-sm btn-outline-warning" type="button"
                    pTooltip="CHANGE TO READY" tooltipPosition="top" placeholder="Top"
                    (click)="updateJobOrderStatusToReady(rowData.jobOrderId)" style="background: #ffc107">
                    <i class="fa fa fa-power-off" style="color: white;"></i>
                  </button>
                  <!-- <button class="btn btn-sm btn-outline-primary" type="button"
                  pTooltip="Processing To Planned" tooltipPosition="top" placeholder="Top"
                  (click)="openProcessModal(rowData)">
                  <i class="fa fa fa-plane"></i>
                </button> -->
                  <button *ngIf="rowData.jobOrderStatus=='STANDBY'" class="btn btn-sm btn-success" type="button"
                    pTooltip="ROLLBACK" tooltipPosition="top" placeholder="Top"
                    (click)="rollbackStandByJobOrder(rowData.jobOrderId)">
                    <i class="fa fa-play" style="color: white;"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" *ngIf="rowData.jobOrderStatus!=='CANCELLED'" type="button"
                    pTooltip="CANCEL Job Order" tooltipPosition="top" placeholder="Top"
                    (click)="cancelJobOrder(rowData.jobOrderId)">
                    <i class="fa fa fa-times"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-success" 
                  *ngIf="rowData.jobOrderStatus==='PLANNED' || rowData.jobOrderStatus==='LONG_TERM_PROCESSING'"
                      type="button" pTooltip="Complete Job Order" tooltipPosition="top" placeholder="Top"
                      (click)="openCompleteModal(rowData)">
                    <i class="fa fa-check-circle"></i></button>
                </td>
              </tr>
            </ng-template>

<!--            <ng-template pTemplate="rowexpansion" let-rowData let-columns="columns">-->
<!--              <tr>-->
<!--                <td colspan="15">-->
<!--                  <div class="ui-g bg-white ">-->
<!--                    <job-order-row-detail [data]="rowData"></job-order-row-detail>-->
<!--                  </div>-->
<!--                </td>-->
<!--              </tr>-->
<!--            </ng-template>-->
          </p-table>


          <div class="row">
            <app-paging [showSearch]="false" [TotalElements]="plannedPagining.totalElements"
              [CurrentPage]="plannedPagining.currentPage" [PageSize]="plannedPagining.pageSize"
              [rows]="plannedPagining.rows" [TotalPageLinkButtons]="plannedPagining.TotalPageLinkButtons"
              [RowsPerPageOptions]="plannedPagining.RowsPerPageOptions"
              (onPageChange)="jobListPageChange($event, plannedPagining, 'planned')"></app-paging>
            <span style="margin-left:2px; padding-top: 2px " class="text-muted">{{'total-records'|translate}}:
              {{plannedPagining?.totalElements}}</span>
          </div>
        </div>

      </div>

    </div>
  </div>
</div>


<p-dialog header="{{panel.title | translate}}" [(visible)]="panel.visible" [autoZIndex]="true" [baseZIndex]="999999"
  #dJoin (mousedown)="moveToJoinTop()" [contentStyle]="{'min-height':'400px'}">

  <div class="col-md-12" *ngIf="panel.title==='divide-job-order'">
    <label>{{'total-quantity' | translate}} : {{selectedReadyJobOrders[0]?.quantity}}</label>
    <p-tabView>
      <p-tabPanel header="{{'manual-division' | translate}}">
        <div class="form-group row">
          <label class="col-md-3 col-form-label" for="manual">{{'number-of-jobs' | translate }}</label>
          <div class="col-md-6">
            <div class="input-group">

              <select id="manual" name="manual" class="form-control" [(ngModel)]="params.numberOfJobs"
                (change)="selectDivideJobs()">
                <option [ngValue]="null"> {{'please-select' | translate}}</option>
                <option *ngFor="let no of [2,3,4,5,6,7,8,9,10]" value="{{no}}">{{no}}</option>
              </select>

            </div>
          </div>
        </div>

        <div class="form-group row mb-1" *ngFor="let item of params.jobList">
          <label class="col-md-3 col-form-label" for="manual">{{item.name}}. {{'job' | translate}} </label>
          <div class="col-md-6">
            <div class="input-group">
              <input class="form-control" type="number" [(ngModel)]="item.value">
            </div>
          </div>
        </div>
        <button [disabled]="!params.jobList || params.jobList.length==0" class="btn btn-success"
          (click)="divideJobs('manual')">{{'save' | translate}}
        </button>
        <div *ngIf="params.error" class="row alert alert-dismissible alert-warning">
          {{params.error}}
        </div>

      </p-tabPanel>
      <p-tabPanel header="{{'auto-division' | translate}}">
        <div class="form-group row">
          <label class="col-md-3 col-form-label" for="auto">{{'number-of-jobs' | translate }}</label>
          <div class="col-md-6">
            <div class="input-group">

              <select id="auto" name="auto" class="form-control" [(ngModel)]="params.numberOfJobs"
                (change)="selectDivideJobs()">
                <option [ngValue]="null"> {{'please-select' | translate}}</option>
                <option *ngFor="let no of [2,3,4,5,6,7,8,9,10]" value="{{no}}">{{no}}</option>
              </select>
            </div>
          </div>
        </div>
        <button [disabled]="!params.numberOfJobs|| params.numberOfJobs==0" class="btn btn-success"
          (click)="divideJobs('auto')">{{'save' | translate}}
        </button>
      </p-tabPanel>
    </p-tabView>
  </div>

  <div class="col-md-12" *ngIf="panel.title==='update-planned-task' || panel.title==='processing-to-planned' || panel.title==='processing-to-completed' || panel.title==='change-to-long-term-processing' || panel.title === 'update-long-term-processing'">
    <table class="table table-bordered">
      <tbody>
        <tr>
          <td>{{'job-order-id' | translate}}</td>
          <td>
            {{this.panel.data?.jobOrderId}}
          </td>
        </tr>
        <tr>
          <td>{{'job-order-operation-id'| translate}}</td>
          <td>
            {{this.panel.data?.jobOrderOperationId}}
          </td>
        </tr>
        <tr>
          <td>{{'start-date'|translate}}</td>
          <td>
            <p-calendar [monthNavigator]="true" [yearNavigator]="true" yearRange="1990:2100" [showTime]="true"
            [showIcon]="true" name="startDate" dateFormat="dd/mm/yy" appendTo="body" [baseZIndex]="99999999"
            [(ngModel)]="reqChangeJobOrderOperationStatusDto.startDate"
            placeholder="{{'start-date'|translate}}"></p-calendar>
            <!-- <p-calendar [(ngModel)]="reqChangeJobOrderOperationStatusDto.startDate" [showIcon]="true" [showTime]="true" [style]="{'overflow': 'visible', 'z-index': '19999','opacity':'1'}" inputId="startDate"></p-calendar> -->
          </td>
        </tr>
        <tr>
          <td>{{'finish-date' |  translate}}</td>
          <td>
            <p-calendar [monthNavigator]="true" [yearNavigator]="true" yearRange="1990:2100" [showTime]="true"
            [showIcon]="true" name="finishDate" dateFormat="dd/mm/yy" appendTo="body" [baseZIndex]="99999999"
            [(ngModel)]="reqChangeJobOrderOperationStatusDto.finishDate"
            placeholder="{{'finish-date'|translate}}"></p-calendar>
            <!-- <p-calendar [(ngModel)]="reqChangeJobOrderOperationStatusDto.finishDate" [showIcon]="true" [showTime]="true" [style]="{'overflow': 'visible', 'z-index': '9999','opacity':'1'}" inputId="finishDate"></p-calendar> -->
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <button class="btn btn-danger float-right" (click)="panel.visible=false;">{{'close' | translate}}</button>
            <button class="btn btn-primary float-right" (click)="processToPlanned()">
            {{'save' | translate}}</button>

          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="col-md-12" *ngIf="panel.title==='complete-job-order'">
    <table class="table table-bordered">
      <tbody>
        <tr>
          <td>{{'job-order-id' | translate}}</td>
          <td>
            {{this.panel.data?.jobOrderId}}
          </td>
        </tr>
        <tr>
          <td>{{'job-order-operation-id'| translate}}</td>
          <td>
            <!-- {{this.panel.data?.jobOrderOperationId}}-->

            <select name="jobOrderOperationId" class="form-control"
            [(ngModel)]="reqChangeJobOrderOperationStatusDto.jobOrderOperationId">
            <!-- <option [ngValue]="null"> {{'please-select' | translate}}</option> -->
            <option *ngFor="let pos of jobOrderOperationIds" [value]="pos">{{pos}}</option>
          </select>
          </td>
        </tr>
        <tr>
          <td>{{'start-date'|translate}}</td>
          <td>
            <p-calendar [monthNavigator]="true" [yearNavigator]="true" yearRange="1990:2100" [showTime]="true"
            [showIcon]="true" name="startDate" dateFormat="dd/mm/yy" appendTo="body" [baseZIndex]="99999999"
            [(ngModel)]="reqChangeJobOrderOperationStatusDto.startDate"
            placeholder="{{'start-date'|translate}}"></p-calendar>
            <!-- <p-calendar [(ngModel)]="reqChangeJobOrderOperationStatusDto.startDate" [showIcon]="true" [showTime]="true" [style]="{'overflow': 'visible', 'z-index': '19999','opacity':'1'}" inputId="startDate"></p-calendar> -->
          </td>
        </tr>
        <tr>
          <td>{{'finish-date' |  translate}}</td>
          <td>
            <p-calendar [monthNavigator]="true" [yearNavigator]="true" yearRange="1990:2100" [showTime]="true"
            [showIcon]="true" name="finishDate" dateFormat="dd/mm/yy" appendTo="body" [baseZIndex]="99999999"
            [(ngModel)]="reqChangeJobOrderOperationStatusDto.finishDate"
            placeholder="{{'finish-date'|translate}}"></p-calendar>
            <!-- <p-calendar [(ngModel)]="reqChangeJobOrderOperationStatusDto.finishDate" [showIcon]="true" [showTime]="true" [style]="{'overflow': 'visible', 'z-index': '9999','opacity':'1'}" inputId="finishDate"></p-calendar> -->
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <table class="table table-bordered">
              <tbody>
                <ng-container *ngFor="let stckq of reqChangeJobOrderOperationStatusDto.stockQuantityList; let i=index;">
                  <tr>
                    <td colspan="2" class="font-weight-bold">{{stckq.stockNo}}-{{stckq.stockName}}</td>
                  </tr>
                  <tr>
                    <td>{{'produced-quantity' | translate}}</td>
                    <td>
                      <input type="number" name="produce{{i}}" class="form-control" [(ngModel)]="stckq.quantity" />
                    </td>
                  </tr>
                  <tr>
                    <td>{{'scrap-quantity' | translate}}</td>
                    <td>
                      <input type="number" name="produce{{i}}" class="form-control" [(ngModel)]="stckq.defectQuantity" />
                    </td>
                  </tr>
                  <tr>
                    <td>{{'rework-quantity' | translate}}</td>
                    <td>
                      <input type="number" name="produce{{i}}" class="form-control" [(ngModel)]="stckq.reworkQuantity" />
                    </td>
                  </tr>
                
              </ng-container>
              </tbody>
            </table>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <button class="btn btn-danger float-right" (click)="panel.visible=false;">{{'close' | translate}}</button>
            <button class="btn btn-primary float-right" (click)="processToComplete()">
            {{'save' | translate}}</button>

          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- <div class="col-md-12" *ngIf="panel.title=='combine-job-orders'">

    <job-order-join [selectedReadyJobOrders]="selectedReadyJobOrders" (saveAction)="joinSaved()"></job-order-join>
  </div> -->


</p-dialog>


<div id="x" bsModal #myModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true">
  <div class="modal-dialog  modal-info" role="document">
    <div class="modal-content" style="width: 600px">
      <div class="modal-header">
        <h4 class="modal-title">
          <span>{{panel.title | translate}}</span>
        </h4>
        <button type="button" class="close" (click)="myModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body" *ngIf="panel.title === 'workstation'">

        <div class="form-group row">

          <div class="col-lg-12">

            <table class="table table-responsive-sm table-hover table-outline mb-0" *ngIf="workstationsForPlanning">
              <thead class="table-secondary">
                <tr>
                  <th>{{'no' | translate}}</th>
                  <th>{{'name' | translate}}</th>
                  <th>{{'default' |translate}}</th>
                  <!-- <th>{{'finish-date' |translate}}</th> -->
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of workstationsForPlanning">
                  <td>{{item.workStationNo}}</td>
                  <td>
                    <a href="javascript:;"
                      (click)="showWorkStationDetail(item.workStationId)">{{item.workStationName}}</a>
                    <div class="small text-muted">
                      <b>{{'type' | translate}}: </b><span>{{item.workStationTypeName}}</span>
                    </div>
                  </td>
                  <!-- <td> {{item.finishDate|date:'dd-MM-yyyy HH:mm:ss'}}</td> -->
                  <td>
                    <p-checkbox [(ngModel)]="item.defaultOperation" [binary]="true" [disabled]="true"></p-checkbox>
                  </td>
                  <td>
                    <button (click)="closePanel(item,'workstation');myModal.hide();"><i class="fa fa-plus"></i></button>
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="row">
              <app-paging [TotalElements]="wsPagination.totalElements" [CurrentPage]="wsPagination.currentPage"
                [PageSize]="wsPagination.pageSize" [rows]="wsPagination.rows"
                [TotalPageLinkButtons]="wsPagination.TotalPageLinkButtons"
                [RowsPerPageOptions]="wsPagination.RowsPerPageOptions" (onPageChange)="myChanges($event)"></app-paging>
              <span style="margin-left:2px; padding-top: 2px " class="text-muted">{{'total-records'|translate}}:
                {{wsPagination?.totalElements}}</span>
            </div>
          </div>
        </div>

      </div>

      <div class="modal-body" *ngIf="panel.title === 'start-date'">

        <div class="form-group row">

          <div class="col-lg-12">
            <p-calendar [(ngModel)]="panel.startDate" [inline]="true" dateFormat="dd/mm/yy" showTime="showTime"
              hourFormat="24" [monthNavigator]="true" [yearNavigator]="true" yearRange="1990:2100"
              (onSelect)="closePanel($event, 'start-date');myModal.hide();"></p-calendar>
          </div>
        </div>

      </div>


      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="myModal.hide()">{{'close' | translate}}</button>
        <!-- <button type="button" class="btn btn-success" (click)="myModal.hide()">{{'save' | translate}}</button> -->
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<ng-template [ngIf]="combineProdModal.active">
  <div bsModal [config]="{backdrop: 'static', keyboard: false, show: true}" #combineProductionModal="bs-modal"
    (onHidden)="combineProdModal.active=false; combineProdModal.data=null; saveCombineOrder = false" class="modal fade" tabindex="-1" role="dialog"
    aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-success" style="max-width: 56%;" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">{{'combine-job-orders' | translate}}</h4>
          <button type="button" class="close" (click)="combineProductionModal.hide()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <combine-production-order [data]="combineProdModal.data" (saveAction)="combineProductionModal.hide(); initialize();"></combine-production-order>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-sm btn-primary" (click)="saveCombineOrderModal()"><i class="fa fa-dot-circle-o"></i>  {{'save' | translate}}</button>
          <button type="button" class="btn btn-secondary"
            (click)="combineProductionModal.hide()">{{'close' | translate}}</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</ng-template>
